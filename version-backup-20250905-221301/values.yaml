# Default values for right-sizer.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

replicaCount: 1

image:
  repository: aavishay/right-sizer
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion (0.1.7)
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

podAnnotations: {}

podSecurityContext: {}
  # fsGroup: 2000

securityContext: {}
  # capabilities:
  #   drop:
  #   - ALL
  # readOnlyRootFilesystem: true
  # runAsNonRoot: true
  # runAsUser: 1000

service:
  type: ClusterIP
  port: 80

resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 128Mi

nodeSelector: {}

tolerations: []

affinity: {}

# RightSizerConfig CRD configuration
rightsizerConfig:
  # Create a default RightSizerConfig resource
  create: true

  # Core configuration
  enabled: true
  mode: "balanced" # adaptive, aggressive, balanced, conservative, custom
  dryRun: false

  # Resource defaults and sizing configuration
  resourceDefaults:
    cpu:
      minRequest: 10 # millicores
      maxLimit: 4000 # millicores
      requestAddition: 0 # millicores to add to calculated request
      limitAddition: 0 # millicores to add to calculated limit
    memory:
      minRequest: 64 # MB
      maxLimit: 8192 # MB
      requestAddition: 0 # MB to add to calculated request
      limitAddition: 0 # MB to add to calculated limit

  # Sizing strategy configuration
  sizingStrategy:
    algorithm: "percentile" # percentile, peak, average
    lookbackPeriod: "7d"
    percentile: 95

    # Scaling factors and multipliers
    scalingFactors:
      cpuRequestMultiplier: 1.2
      cpuLimitMultiplier: 2.0
      memoryRequestMultiplier: 1.2
      memoryLimitMultiplier: 2.0
      maxChangePercentage: 50
      minChangeThreshold: 10

    # Thresholds for scaling decisions
    thresholds:
      cpuScaleUpThreshold: 0.8 # 80% utilization triggers scale up
      cpuScaleDownThreshold: 0.3 # 30% utilization triggers scale down
      memoryScaleUpThreshold: 0.8
      memoryScaleDownThreshold: 0.3

  # Global constraints
  constraints:
    maxMemoryGB: 32
    maxCPUCores: 16
    preventOOMKill: true
    respectPodDisruptionBudget: true

  # Monitoring and metrics configuration
  monitoring:
    metricsProvider: "metrics-server" # metrics-server, prometheus, custom
    # prometheusURL: "http://prometheus:9090"
    # metricsServerEndpoint: "http://metrics-server:8080"
    scrapeInterval: "30s"
    retentionPeriod: "30d"
    aggregationMethod: "avg" # avg, max, min, percentile
    includeCustomMetrics: false

  # Observability configuration
  observability:
    enableMetricsExport: true
    metricsPort: 9090
    enableTracing: false
    # tracingEndpoint: "http://jaeger:4318"
    enableProfiling: false
    profilingPort: 6060

  # Security configuration
  security:
    enableAdmissionController: false
    admissionWebhookPort: 8443
    requireAnnotation: false
    annotationKey: "rightsizer.io/enable"
    enableMutatingWebhook: false
    enableValidatingWebhook: false
    tlsCertDir: "/tmp/certs"
    webhookTimeoutSeconds: 10

  # Operator configuration
  operator:
    leaderElection: true
    leaderElectionNamespace: "" # Uses release namespace if empty
    leaderElectionID: "right-sizer-leader"
    leaderElectionLeaseDuration: "15s"
    leaderElectionRenewDeadline: "10s"
    leaderElectionRetryPeriod: "2s"
    syncPeriod: "30s"
    maxConcurrentReconciles: 3
    workerThreads: 10
    qps: 20
    burst: 30
    healthProbePort: 8081
    readinessEndpoint: "/readyz"
    livenessEndpoint: "/healthz"

  # Operational configuration
  operationalConfig:
    resizeInterval: "5m"
    retryAttempts: 3
    retryInterval: "5s"
    batchSize: 3
    delayBetweenBatches: "5s"
    delayBetweenPods: "500ms"
    maxUpdatesPerRun: 50

  # Namespace configuration
  namespaceConfig:
    # Namespaces to include (empty means all)
    includeNamespaces: []
    # Example:
    # includeNamespaces:
    #   - "default"
    #   - "production"

    # Namespaces to exclude from right-sizing
    excludeNamespaces:
      - "kube-system"
      - "kube-public"
      - "kube-node-lease"
      - "cert-manager"
      - "ingress-nginx"
      - "istio-system"

    # System namespaces that should never be modified
    systemNamespaces:
      - "kube-system"
      - "kube-public"
      - "kube-node-lease"
      - "cert-manager"
      - "ingress-nginx"
      - "istio-system"

    # Select namespaces by labels
    namespaceLabels: {}
    # Example:
    # namespaceLabels:
    #   environment: "production"
    #   team: "platform"

  # Logging configuration
  logging:
    level: "info" # debug, info, warn, error
    format: "json" # json, text
    enableAudit: true

  # Notification configuration
  notifications:
    enabled: false

    # Slack notifications
    slack: {}
    # Example:
    # slack:
    #   webhookURL: "https://hooks.slack.com/services/YOUR/WEBHOOK/URL"
    #   channel: "#right-sizer"
    #   username: "RightSizer"
    #   iconEmoji: ":robot:"
    #   notifyOnSuccess: false
    #   notifyOnFailure: true
    #   notifyOnDryRun: false

    # Email notifications
    email: {}
    # Example:
    # email:
    #   smtpHost: "smtp.gmail.com"
    #   smtpPort: 587
    #   smtpUsername: "notifications@example.com"
    #   smtpPasswordSecret: "smtp-password-secret"
    #   from: "rightsizer@example.com"
    #   to:
    #     - "ops-team@example.com"
    #     - "platform@example.com"
    #   subject: "RightSizer Alert"

    # Webhook notifications
    webhook: {}
    # Example:
    # webhook:
    #   url: "https://your-webhook.example.com/alerts"
    #   method: "POST"
    #   headers:
    #     Authorization: "Bearer YOUR_TOKEN"
    #     Content-Type: "application/json"
    #   retryCount: 3
    #   retryDelay: "5s"

  # Feature gates for experimental features
  featureGates:
    enableInPlaceResize: true # Use in-place pod resizing (K8s 1.27+)
    enablePredictiveScaling: false # ML-based predictive scaling
    enableCostOptimization: false # Cost-aware resource optimization
    enableMultiCluster: false # Multi-cluster support
    enableAutoLearning: false # Auto-learn optimal resource patterns
    enableWorkloadProfiling: false # Profile workload patterns
    enableAdvancedScheduling: false # Advanced scheduling optimizations
