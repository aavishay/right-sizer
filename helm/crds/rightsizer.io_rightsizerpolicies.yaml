---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.19.0
  name: rightsizerpolicies.rightsizer.io
spec:
  group: rightsizer.io
  names:
    kind: RightSizerPolicy
    listKind: RightSizerPolicyList
    plural: rightsizerpolicies
    shortNames:
    - rsp
    singular: rightsizerpolicy
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.enabled
      name: Enabled
      type: boolean
    - jsonPath: .spec.mode
      name: Mode
      type: string
    - jsonPath: .status.phase
      name: Status
      type: string
    - jsonPath: .status.lastAppliedTime
      name: Last Applied
      type: date
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: RightSizerPolicy is the Schema for the rightsizerpolicies API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: RightSizerPolicySpec defines the desired state of RightSizerPolicy
            properties:
              constraints:
                description: Constraints defines resource constraints and limits
                properties:
                  cooldownPeriod:
                    default: 5m
                    description: CooldownPeriod between adjustments
                    type: string
                  maxChangePercentage:
                    description: MaxChangePercentage limits how much resources can
                      change in one adjustment
                    format: int32
                    maximum: 100
                    minimum: 0
                    type: integer
                  minChangeThreshold:
                    description: MinChangeThreshold below which changes are not applied
                      (percentage)
                    format: int32
                    maximum: 100
                    minimum: 0
                    type: integer
                  respectHPA:
                    default: true
                    description: RespectHPA ensures HorizontalPodAutoscalers are not
                      conflicted
                    type: boolean
                  respectPDB:
                    default: true
                    description: RespectPDB ensures PodDisruptionBudgets are respected
                    type: boolean
                  respectVPA:
                    default: true
                    description: RespectVPA ensures VerticalPodAutoscalers are not
                      conflicted
                    type: boolean
                type: object
              dryRun:
                default: false
                description: DryRun enables dry-run mode for this policy
                type: boolean
              enabled:
                default: true
                description: Enabled indicates if this policy is active
                type: boolean
              mode:
                default: balanced
                description: Mode defines the sizing mode for this policy
                enum:
                - aggressive
                - balanced
                - conservative
                - custom
                type: string
              priority:
                default: 100
                description: Priority determines the order of policy application (higher
                  priority wins)
                format: int32
                maximum: 1000
                minimum: 0
                type: integer
              resourceAnnotations:
                additionalProperties:
                  type: string
                description: Annotations to add to resized resources
                type: object
              resourceStrategy:
                description: ResourceStrategy defines how resources should be calculated
                properties:
                  cpu:
                    description: CPU request calculation strategy
                    properties:
                      limitAddition:
                        description: LimitAddition in millicores to add to CPU limits
                        format: int64
                        minimum: 0
                        type: integer
                      limitMultiplier:
                        description: LimitMultiplier for CPU limits
                        maximum: 10
                        minimum: 0.1
                        type: number
                      maxLimit:
                        description: MaxLimit in millicores
                        format: int64
                        minimum: 0
                        type: integer
                      minRequest:
                        description: MinRequest in millicores
                        format: int64
                        minimum: 0
                        type: integer
                      requestAddition:
                        description: RequestAddition in millicores to add to CPU requests
                        format: int64
                        minimum: 0
                        type: integer
                      requestMultiplier:
                        description: RequestMultiplier for CPU requests
                        maximum: 10
                        minimum: 0.1
                        type: number
                      targetUtilization:
                        description: TargetUtilization percentage (0-100)
                        format: int32
                        maximum: 100
                        minimum: 0
                        type: integer
                    type: object
                  historyWindow:
                    default: 7d
                    description: HistoryWindow defines how much historical data to
                      consider
                    type: string
                  memory:
                    description: Memory calculation strategy
                    properties:
                      limitAddition:
                        description: LimitAddition in MB to add to memory limits
                        format: int64
                        minimum: 0
                        type: integer
                      limitMultiplier:
                        description: LimitMultiplier for memory limits
                        maximum: 10
                        minimum: 0.1
                        type: number
                      maxLimit:
                        description: MaxLimit in MB
                        format: int64
                        minimum: 0
                        type: integer
                      minRequest:
                        description: MinRequest in MB
                        format: int64
                        minimum: 0
                        type: integer
                      requestAddition:
                        description: RequestAddition in MB to add to memory requests
                        format: int64
                        minimum: 0
                        type: integer
                      requestMultiplier:
                        description: RequestMultiplier for memory requests
                        maximum: 10
                        minimum: 0.1
                        type: number
                      targetUtilization:
                        description: TargetUtilization percentage (0-100)
                        format: int32
                        maximum: 100
                        minimum: 0
                        type: integer
                    type: object
                  metricsSource:
                    default: metrics-server
                    description: MetricsSource defines where to get metrics from
                    enum:
                    - metrics-server
                    - prometheus
                    - custom
                    type: string
                  percentile:
                    default: 95
                    description: Percentile to use for resource calculations (50,
                      90, 95, 99)
                    enum:
                    - 50
                    - 90
                    - 95
                    - 99
                    format: int32
                    type: integer
                  prometheusConfig:
                    description: PrometheusConfig for Prometheus metrics source
                    properties:
                      auth:
                        description: Auth configuration for Prometheus
                        properties:
                          basicAuth:
                            description: BasicAuth configuration
                            properties:
                              passwordSecretRef:
                                description: Password reference from secret
                                properties:
                                  key:
                                    description: The key of the secret to select from.  Must
                                      be a valid secret key.
                                    type: string
                                  name:
                                    default: ""
                                    description: |-
                                      Name of the referent.
                                      This field is effectively required, but due to backwards compatibility is
                                      allowed to be empty. Instances of this type with an empty value here are
                                      almost certainly wrong.
                                      More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                                    type: string
                                  optional:
                                    description: Specify whether the Secret or its
                                      key must be defined
                                    type: boolean
                                required:
                                - key
                                type: object
                                x-kubernetes-map-type: atomic
                              username:
                                description: Username for basic auth
                                type: string
                            required:
                            - passwordSecretRef
                            - username
                            type: object
                          bearerToken:
                            description: BearerToken for authentication
                            type: string
                          tlsConfig:
                            description: TLSConfig for TLS configuration
                            properties:
                              caSecretRef:
                                description: CAFile path or secret reference
                                properties:
                                  key:
                                    description: The key of the secret to select from.  Must
                                      be a valid secret key.
                                    type: string
                                  name:
                                    default: ""
                                    description: |-
                                      Name of the referent.
                                      This field is effectively required, but due to backwards compatibility is
                                      allowed to be empty. Instances of this type with an empty value here are
                                      almost certainly wrong.
                                      More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                                    type: string
                                  optional:
                                    description: Specify whether the Secret or its
                                      key must be defined
                                    type: boolean
                                required:
                                - key
                                type: object
                                x-kubernetes-map-type: atomic
                              insecureSkipVerify:
                                description: InsecureSkipVerify disables TLS verification
                                type: boolean
                            type: object
                        type: object
                      cpuQuery:
                        description: CPUQuery for fetching CPU metrics
                        type: string
                      memoryQuery:
                        description: MemoryQuery for fetching memory metrics
                        type: string
                      url:
                        description: URL of Prometheus server
                        type: string
                    required:
                    - url
                    type: object
                  updateMode:
                    default: rolling
                    description: UpdateMode defines how updates should be applied
                    enum:
                    - immediate
                    - rolling
                    - scheduled
                    type: string
                type: object
              schedule:
                description: Schedule defines when this policy should be evaluated
                properties:
                  cronSchedule:
                    description: CronSchedule for cron-based evaluation
                    type: string
                  interval:
                    default: 1m
                    description: Interval between evaluations (e.g., "30s", "5m",
                      "1h")
                    type: string
                  timeWindows:
                    description: TimeWindows when the policy is active
                    items:
                      description: TimeWindow defines a time window when the policy
                        is active
                      properties:
                        daysOfWeek:
                          description: DaysOfWeek when this window is active
                          enum:
                          - Monday
                          - Tuesday
                          - Wednesday
                          - Thursday
                          - Friday
                          - Saturday
                          - Sunday
                          items:
                            type: string
                          type: array
                        end:
                          description: End time in format "HH:MM"
                          type: string
                        start:
                          description: Start time in format "HH:MM"
                          type: string
                        timezone:
                          default: UTC
                          description: Timezone for the time window
                          type: string
                      required:
                      - end
                      - start
                      type: object
                    type: array
                type: object
              targetRef:
                description: TargetRef defines which resources this policy applies
                  to
                properties:
                  annotationSelector:
                    additionalProperties:
                      type: string
                    description: AnnotationSelector for selecting resources based
                      on annotations
                    type: object
                  apiVersion:
                    default: apps/v1
                    description: APIVersion of the target resource
                    type: string
                  excludeNames:
                    description: ExcludeNames of specific resources to exclude
                    items:
                      type: string
                    type: array
                  excludeNamespaces:
                    description: ExcludeNamespaces to exclude from this policy
                    items:
                      type: string
                    type: array
                  kind:
                    description: Kind of resources to target (Deployment, StatefulSet,
                      DaemonSet, Pod)
                    enum:
                    - Deployment
                    - StatefulSet
                    - DaemonSet
                    - Pod
                    - ReplicaSet
                    - Job
                    - CronJob
                    type: string
                  labelSelector:
                    description: LabelSelector for selecting resources
                    properties:
                      matchExpressions:
                        description: matchExpressions is a list of label selector
                          requirements. The requirements are ANDed.
                        items:
                          description: |-
                            A label selector requirement is a selector that contains values, a key, and an operator that
                            relates the key and values.
                          properties:
                            key:
                              description: key is the label key that the selector
                                applies to.
                              type: string
                            operator:
                              description: |-
                                operator represents a key's relationship to a set of values.
                                Valid operators are In, NotIn, Exists and DoesNotExist.
                              type: string
                            values:
                              description: |-
                                values is an array of string values. If the operator is In or NotIn,
                                the values array must be non-empty. If the operator is Exists or DoesNotExist,
                                the values array must be empty. This array is replaced during a strategic
                                merge patch.
                              items:
                                type: string
                              type: array
                              x-kubernetes-list-type: atomic
                          required:
                          - key
                          - operator
                          type: object
                        type: array
                        x-kubernetes-list-type: atomic
                      matchLabels:
                        additionalProperties:
                          type: string
                        description: |-
                          matchLabels is a map of {key,value} pairs. A single {key,value} in the matchLabels
                          map is equivalent to an element of matchExpressions, whose key field is "key", the
                          operator is "In", and the values array contains only "value". The requirements are ANDed.
                        type: object
                    type: object
                    x-kubernetes-map-type: atomic
                  names:
                    description: Names of specific resources to target
                    items:
                      type: string
                    type: array
                  namespaces:
                    description: Namespaces to include (empty means all namespaces)
                    items:
                      type: string
                    type: array
                type: object
              webhooks:
                description: Webhooks defines webhook notifications for policy events
                items:
                  description: WebhookSpec defines webhook notification configuration
                  properties:
                    events:
                      description: Events to send notifications for
                      enum:
                      - resize
                      - error
                      - warning
                      - info
                      items:
                        type: string
                      type: array
                    headers:
                      additionalProperties:
                        type: string
                      description: Headers to include in webhook requests
                      type: object
                    retryPolicy:
                      description: RetryPolicy for failed webhook calls
                      properties:
                        maxRetries:
                          default: 3
                          description: MaxRetries for failed webhook calls
                          format: int32
                          type: integer
                        retryInterval:
                          default: 5s
                          description: RetryInterval between attempts
                          type: string
                      type: object
                    url:
                      description: URL of the webhook endpoint
                      type: string
                  required:
                  - events
                  - url
                  type: object
                type: array
            required:
            - targetRef
            type: object
          status:
            description: RightSizerPolicyStatus defines the observed state of RightSizerPolicy
            properties:
              conditions:
                description: Conditions represent the latest available observations
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              lastAppliedTime:
                description: LastAppliedTime when the policy was last applied
                format: date-time
                type: string
              lastEvaluationTime:
                description: LastEvaluationTime when the policy was last evaluated
                format: date-time
                type: string
              message:
                description: Message provides additional status information
                type: string
              metrics:
                description: Metrics provides current metrics summary
                properties:
                  averageCPUUtilization:
                    description: AverageCPUUtilization across affected resources
                    format: int32
                    type: integer
                  averageMemoryUtilization:
                    description: AverageMemoryUtilization across affected resources
                    format: int32
                    type: integer
                  lastUpdated:
                    description: LastUpdated timestamp
                    format: date-time
                    type: string
                  totalCPURequests:
                    description: TotalCPURequests in millicores
                    format: int64
                    type: integer
                  totalMemoryRequests:
                    description: TotalMemoryRequests in MB
                    format: int64
                    type: integer
                type: object
              observedGeneration:
                description: ObservedGeneration for tracking spec changes
                format: int64
                type: integer
              phase:
                description: Phase of the policy (Pending, Active, Failed, Suspended)
                type: string
              resourcesAffected:
                description: ResourcesAffected count of resources affected by this
                  policy
                format: int32
                type: integer
              resourcesResized:
                description: ResourcesResized count of resources actually resized
                format: int32
                type: integer
              totalSavings:
                description: TotalSavings estimated resource savings
                properties:
                  costSaved:
                    description: CostSaved estimated cost savings
                    type: string
                  cpuSaved:
                    description: CPUSaved in millicores
                    format: int64
                    type: integer
                  memorySaved:
                    description: MemorySaved in MB
                    format: int64
                    type: integer
                type: object
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
